<form class="d-flex">
  <div class="pe-3">
    <mat-form-field>
      <input matInput [matDatepicker]="dp" placeholder="Month and Year" [(ngModel)]="filter.dateReference"
        [ngModelOptions]="{standalone: true}">
      <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
      <mat-datepicker #dp startView="multi-year" (yearSelected)="choosenYear($event, dp)"></mat-datepicker>
    </mat-form-field>
  </div>
  <div class="pe-3">
    <mat-form-field>
      <mat-label>Tipo de Ação</mat-label>
      <mat-select matSelect [(ngModel)]="filter.typeReference" [ngModelOptions]="{standalone: true}" 
          placeholder="Selecione..." (ngModelChange)="doFilter()">
        <mat-option [value]="">Todos</mat-option>
        @for (type of assetTypes; track $index) {
          <mat-option [value]="type">{{ type | assetType }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>
</form>

<!-- Criação do formArray -->
<table mat-table [dataSource]="data()" class="mat-elevation-z8 w-100 mat-table-hover">

  <ng-container matColumnDef="ticket">
    <th mat-header-cell *matHeaderCellDef> Código </th>
    <td mat-cell *matCellDef="let element; let idx = index" 
      [attr.rowspan]="3"
      [style.display]="element.acronym !== 'DY' ? 'none': ''">

      <div>
        {{element.ticket}}
      </div>
      <div>
        <i>
          {{element.description}}
        </i>
      </div>
    </td>
    <th mat-footer-cell *matFooterCellDef>Total</th>
  </ng-container>

  
  <ng-container matColumnDef="acronym">
    <th mat-header-cell *matHeaderCellDef> T </th>
    <td mat-cell *matCellDef="let element"> {{element.acronym}} </td>
    <th mat-footer-cell *matFooterCellDef ></th>
  </ng-container>

  @for(month of months; track $index) {
    <ng-container [matColumnDef]="vlMonths[$index]">
      <th mat-header-cell *matHeaderCellDef class="vlMonth"> {{month}} </th>
      <td mat-cell *matCellDef="let element" class="number cell vlMonth" (click)="openDialog($index, element.acronym, element)">
        @if (element.entries[$index].amount == 0) {
        <div class="w-100 text-center">
          -
        </div>
        }
        @else {
        <div class="w-100 text-end">
          {{ element.entries[$index].amount | number:'1.2-2'}}
        </div>
        }
      </td>
      <th mat-footer-cell *matFooterCellDef class="number vlMonth">
        <div class="w-100 text-end pe-3">
          {{ totalMonth($index) | number:'1.2-2' }}
        </div>
      </th>
    </ng-container>
  }


  <!-- Cabeçalho e linhas -->
  <tr mat-header-row *matHeaderRowDef="displayedColumns" ></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns" ></tr>
  <tr mat-footer-row *matFooterRowDef="displayedColumns" class="table-total" ></tr>
</table>
<!-- <code>
  <pre>{{data() | json}}</pre>
</code> -->